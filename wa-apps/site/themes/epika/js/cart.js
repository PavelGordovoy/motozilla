$(function(){function a(a){var e=c(a.total),f=c(a.discount);$(".cart-discount").closest("div.row").show(),d($(".cart-discount"),f,"&minus; "),d($(".cart-total"),e,""),b(),a.add_affiliate_bonus?$(".affiliate").show().html('<i class="icon-heart-1"></i> '+a.add_affiliate_bonus):$(".affiliate").hide(),$(".items-count-val").html(a.count),$(".cart_count").html(a.count)}function b(){var a=0;$(".cart-summary-page .item-total-value").each(function(){a+=c($(this).html())}),d($(".cart-summary-page .cart-subtotal"),a,""),a=0,$(".fl-cart-in .item-total-value").each(function(){a+=c($(this).html())}),d($(".fl-cart-in .cart-subtotal"),a,"")}function c(a){var b=a.toString(),c=b.replace(" ","").trim();return c=c.replace(" ","").trim(),c=c.replace(currency_info.sign,""),c=c.replace(currency_info.sign_html,""),c=parseFloat(c.replace(",","."))}function d(a,b,d){var e=c(b);$(a).length<=0||$(a).animateNumber({number:e,numberStep:function(a,b){var c,e,f,g,h,i=locale_info.frac_digits,j=locale_info.decimal_point,k=locale_info.thousands_sep,l=a,m=$(b.elem);isNaN(i=Math.abs(i))&&(i=2),void 0==j&&(j=","),void 0==k&&(k="."),c=parseInt(l=(+l||0).toFixed(i))+"",(e=c.length)>3?e%=3:e=0,h=e?c.substr(0,e)+k:"",f=c.substr(e).replace(/(\d{3})(?=\d)/g,"$1"+k),g=i&&l-c?j+Math.abs(l-c).toFixed(i).replace(/-/,0).slice(2):"",l=h+f+g;var n=void 0!=currency_info.sign_delim?currency_info.sign_delim:" ",o=currency_info.sign_html;void 0==currency_info.sign_html&&(o=currency_info.sign),void 0!=currency_info.sign_position?m.html(d+o+n+l):m.html(d+l+n+o)}})}$(document).on("click",".cart-content a.goto-cart",function(a){a.preventDefault(),a.stopPropagation()}),$(document).on("click","#cart a.fl-cart-remove-all",function(a){var b=$("a.delete").length,c=0;$("a.delete").each(function(){var a=$(this).closest(".cart-item");$.post(_wa_url+"cart/delete/",{html:1,id:a.data("id")},function(d){a.addClass("effectBounceOut"),a.fadeOut("slow",function(){$(a).remove(),++c>=b&&$.get(_wa_url+"cart/",{type:"minicart"},function(a){$(".fly-in-cart").html(a),$(".remodal_in").find(".cart-content").length>0&&$(".remodal_in").html(a)})})},"json")}),$(".cart_count").html("0"),$.cookie("epika_shop_incart",null,{expires:30,path:"/"})}),$(document).on("click",".remodal_in .cart-coupon-btn",function(a){a.preventDefault(),a.stopPropagation();var b=$('.remodal_in input[name="coupon_code"]').val();return $.post(_wa_url+"cart/",{html:1,coupon_code:b},function(a){$(".fly-in-cart").html(""),$(".remodal_in").html(a);var b=$(a).find(".items-count-val").html();$("#cart a").find(".items-count-val").html(b),$(".cart_count").html(b)}),!1}),$(document).on("click",".remodal_in #cancel-affiliate, .remodal_in .use-affiliate-btn",function(a){a.preventDefault(),a.stopPropagation();var b=1;return"cancel-affiliate"==$(this).attr("id")&&(b=0),$.post(_wa_url+"cart/",{html:1,use_affiliate:b},function(a){$(".fly-in-cart").html(""),$(".remodal_in").html(a);var b=$(a).find(".items-count-val").html();$("#cart a").find(".items-count-val").html(b),$(".cart_count").html(b)}),!1}),$(document).on("click",".cart-content a.delete",function(b){b.preventDefault(),b.stopPropagation();var c=$(this),d=$(".cart_count"),e=$(this).closest(".cart-item"),f=$.cookie("epika_shop_incart");f=f?f.split(","):[];var g=$.inArray(c.data("id")+"",f);-1!=g&&f.splice(g,1),f.length>0?$.cookie("epika_shop_incart",f.join(","),{expires:30,path:"/"}):$.cookie("epika_shop_incart",null,{path:"/"});var h=null;return $(this).closest(".fly-in-mini-cart").length>0&&(h={type:"minicart"}),$.post(_wa_url+"cart/delete/",{html:1,id:e.data("id")},function(b){0==b.data.count&&$.get(_wa_url+"cart/",h,function(a){$(".fly-in-cart").html(""),$(".remodal_in").find(".cart-content").length>0&&$(".remodal_in").html(a)}),e.addClass("effectBounceOut"),e.fadeOut("slow",function(){$(e).remove(),setTimeout(function(){a(b.data),d.html(b.data.count)},100)})},"json"),!1}),$(document).on("click",".qtyminusCart, .qtyplusCart",function(b){b.preventDefault(),b.stopPropagation();var c=$(this).parent().find("input.qty"),d=parseInt(c.val());if($(this).hasClass("qtyplusCart"))c.val(d+1);else{if(!(d-1>0))return;c.val(d-1)}if(c.val()>0){var e=c.closest(".cart-item");c.val()&&$.post(_wa_url+"cart/save/",{html:1,id:e.data("id"),quantity:c.val()},function(b){e.find(".item-total").html(b.data.item_total),b.data.q&&c.val(b.data.q),b.data.error?alert(b.data.error):c.removeClass("error"),a(b.data)},"json")}else c.val(1)}),$(document).on("change input",".cart-content input.qty, input.item-qty",function(){var b=$(this);if(b.val()>0){var c=b.closest(".cart-item");b.val()&&$.post(_wa_url+"cart/save/",{html:1,id:c.data("id"),quantity:b.val()},function(d){c.find(".item-total").html(d.data.item_total),d.data.q&&b.val(d.data.q),d.data.error?alert(d.data.error):b.removeClass("error"),a(d.data)},"json")}else b.val(1)}),$(document).on("change",".cart-content .services input:checkbox",function(){var b=$('select[name="service_variant['+$(this).closest(".cart-item").data("id")+"]["+$(this).val()+']"]');b.length&&($(this).is(":checked")?b.removeAttr("disabled"):b.attr("disabled","disabled")),$(this).is(":checked")?$(this).parent().addClass("checked"):$(this).parent().removeClass("checked");var c=$(this).closest("div"),d=$(this).closest(".cart-item");if($(this).is(":checked")){var e=d.data("id"),f={html:1,parent_id:e,service_id:$(this).val()},g=$('select[name="service_variant['+e+"]["+$(this).val()+']"]');g.length&&(f.service_variant_id=g.val()),$.post(_wa_url+"cart/add/",f,function(b){c.data("id",b.data.id),d.find(".item-total").html(b.data.item_total),a(b.data)},"json")}else $.post(_wa_url+"cart/delete/",{html:1,id:c.data("id")},function(b){c.data("id",null),d.find(".item-total").html(b.data.item_total),a(b.data)},"json")}),$(document).on("change",".cart-content .services select",function(){var b=$(this).closest(".cart-item");$.post(_wa_url+"cart/save/",{html:1,id:$(this).closest("div").data("id"),service_variant_id:$(this).val()},function(c){b.find(".item-total").html(c.data.item_total),a(c.data)},"json")}),$(document).on("click","#use-coupon",function(a){return a.preventDefault(),a.stopPropagation(),$("#discount-row:hidden").slideToggle(200),$("#discount-row").addClass("highlighted"),$("#apply-coupon-code:hidden").show(),$('#apply-coupon-code input[type="text"]').focus(),!1}),$(document).on("click","div.addtocart input:button",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest("div.addtocart");if(b.data("url")){var c=$("#dialog"),d=c.find(".cart-content");return d.load(b.data("url"),function(){d.prepend('<a href="#" class="dialog-close">&times;</a>'),d.find("form").data("cart",1),c.show(),d.height()>d.find("form").height()?d.css("bottom","auto"):d.css("bottom","15%")}),!1}return $.post($(this).data("url"),{html:1,product_id:$(this).data("product_id")},function(a){if("ok"==a.status){var c=$(".cart-total");$("#page-content").load(location.href,function(){c.closest("#cart").removeClass("empty"),c.html(a.data.total),$("#cart").addClass("fixed"),$("#cart-content").append($('<div class="cart-just-added"></div>').html(b.find("span.added2cart").text())),$(".cart-to-checkout").slideDown(200)})}},"json"),!1})});